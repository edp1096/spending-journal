<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Spending journal</title>

    <link rel="stylesheet" href="assets/css/pico.min.css">
    <link rel="stylesheet" href="assets/css/pico.colors.min.css">
    <script src="assets/js/alpine.min.js" defer></script>

    <link rel="stylesheet" href="assets/css/styles.css">
    <script src="assets/js/scripts.js"></script>
</head>

<body x-data="allData">
    <div class="main-container">

        <!-- Main menu -->
        <div class="main-header-container">
            <h2>ÏßÄÏ∂úÍ∏∞ÏûÖÏû•</h2>

            <div class="header-button-container">
                <button @click="showAccounts" class="outline secondary">Accounts</button>
                <button @click="showRecords" class="outline secondary">Pay records</button>
                <button class="icon-button">‚öôÔ∏è</button>
            </div>
        </div>

        <!-- Payment accounts -->
        <template x-if="showAccountList">
            <div class="table-container">
                <button @click="openInputAccount" class="full-size bg-sand">Add account</button>

                <table>
                    <thead>
                        <template x-if="accounts.length > 0">
                            <tr>
                                <th>Í≥ÑÏ†ï Ïù¥Î¶Ñ</th>
                                <th>Í≥ÑÏ†ï Ïú†Ìòï</th>
                                <th>Í≤∞Ï†úÏùº</th>
                            </tr>
                        </template>
                    </thead>
                    <tbody>
                        <template x-for="m in accounts">
                            <tr>
                                <td x-text="m['account-name']"></td>
                                <td x-text="m['pay-type']"></td>
                                <td x-text="m['repay-day']"></td>
                            </tr>
                        </template>
                    </tbody>
                </table>
            </div>
        </template>

        <!-- Payment records -->
        <template x-if="showRecordList">
            <div class="table-container">
                <button @click="openInputRecord" class="full-size bg-sand">Add record</button>

                <table>
                    <thead>
                        <template x-if="recordsResponse.records && recordsResponse.records.length > 0">
                            <tr>
                                <th>ÏùºÏãú</th>
                                <th>Î∂ÑÎ•ò</th>
                                <th>ÏßÄÎ∂à</th>
                                <th>Í∏àÏï°</th>
                                <th>ÏÇ≠Ï†ú</th>
                            </tr>
                        </template>
                    </thead>
                    <tbody>
                        <template x-for="(r, index) in recordsResponse.records" :key="index">
                            <tr @click="openInputRecord(index)">
                                <td x-text="`${r.date} ${r.time}`"></td>
                                <td x-text="r.category"></td>
                                <td x-text="`${payType[r['pay-type']]}`"></td>
                                <td x-text="`${currencyCode[r.currency]} ${r.amount}`"></td>
                                <td class="one">
                                    <button @click.stop="deleteRecord(index)" type="button" class="bg-red">X</button>
                                </td>
                            </tr>
                        </template>
                    </tbody>
                </table>
            </div>
        </template>

        <hr>

        <div class="summary-container">
            <span x-text="`Income total: ${(recordsResponse['sum-income'] ?? 0)}`"></span>
            <span x-text="`Pay total: ${(recordsResponse['sum-pay'] ?? 0)}`"></span>
        </div>
    </div>

    <!-- Entering password input -->
    <div x-data="{ open: true }" x-init="$refs.passwordInput.focus()" id="password-gate-container">
        <div id="password-gate" x-show="open" x-transition class="dialog-fullsize dialog-enter-password">
            <p>
                Please enter password üîê
            </p>

            <form x-ref="passwordForm">
                <input x-ref="passwordInput" type="password" id="password" placeholder="Password" required>
                <button @click="enterPassword($event)">Ok</button>
            </form>
        </div>
    </div>

    <!-- Add/Edit pay account -->
    <div x-data="accountData" @keyup.escape.window="open = false">
        <form x-ref="accountForm" id="input-account" class="dialog-fullsize dialog-add-edit" x-show="open" x-transition>
            <h2>Í≥ÑÏ†ï(Ïπ¥Îìú/ÌÜµÏû•) Ï†ïÎ≥¥ ÏûÖÎ†•</h2>

            <input x-model="account['account-name']" placeholder="Í≥ÑÏ†ïÏù¥Î¶Ñ">
            <select x-model="account['pay-type']">
                <option value="direct">ÏßÅÎ∂à/ÌòÑÍ∏à</option>
                <option value="credit">Ïã†Ïö©/Ïô∏ÏÉÅ</option>
            </select>

            <select x-model="account['repay-day']">
                <option value="">Ïõî Í≤∞Ï†úÏùº</option>
                <template x-for="day in 31" :key="day">
                    <option :value="day" x-text="day"></option>
                </template>
            </select>

            <textarea name="account.description" placeholder="Î©îÎ™®"></textarea>

            <div class="dialog-button-container">
                <button @click="open = !open" type="button" class="bg-red">Cancel</button>
                <button @click="setAccount($event)" type="button">Ok</button>
            </div>
        </form>
    </div>

    <!-- Add/Edit record -->
    <div x-data="recordData" @keyup.escape.window="open = false">
        <form x-ref="recordForm" id="input-record" class="dialog-fullsize dialog-add-edit" x-show="open" x-transition>
            <h2>Í±∞Îûò ÏûÖÎ†•/ÏàòÏ†ï</h2>

            <select x-model="record['transaction-type']">
                <option value="record_type_pay">ÏßÄÏ∂ú</option>
                <option value="record_type_income">ÏàòÏûÖ</option>
            </select>

            <select x-model="record['pay-type']">
                <option value="direct">ÏßÅÎ∂à/ÌòÑÍ∏à</option>
                <option value="credit">Ïã†Ïö©/Ïô∏ÏÉÅ</option>
            </select>

            <div class="datalist-input-container">
                <input x-model="accountName" x-ref="payAccount" list="account-list" placeholder="Í≥ÑÏ†ï" required>
                <datalist id="account-list">
                    <template x-for="(a, index) in accounts" :key="index">
                        <option :value="a['account-name']"></option>
                    </template>
                </datalist>
                <button @click="accountName=''; $refs.payAccount.focus()" class="clear" type="button">X</button>
            </div>

            <div class="datalist-input-container">
                <input x-model="record.category" x-ref="payCategory" list="category-list" placeholder="Î∂ÑÎ•ò" required>
                <datalist id="category-list">
                    <option value="ÏãùÎπÑ">
                    <option value="Í∞ÑÏãù">
                    <option value="ÍµêÌÜµ">
                    <option value="Îã¥Î∞∞">
                </datalist>
                <button @click="record.category=''; $refs.payCategory.focus()" class="clear" type="button">X</button>
            </div>

            <select x-model="record.currency" class="third">
                <option value="KRW">Ïõê</option>
                <option value="USD">Îã¨Îü¨</option>
            </select>
            <input x-model="record.amount" type="number" :step="numberStep[record.currency]" class="seventh" placeholder="Í∏àÏï°" required>

            <input x-model="record.date" class="half-size" type="date" placeholder="Í±∞ÎûòÏùº">
            <input x-model="record.time" class="half-size" type="time" placeholder="Í±∞ÎûòÏãúÍ∞Ñ">
            <textarea x-model="record.description" placeholder="Î©îÎ™®"></textarea>

            <div class="dialog-button-container">
                <button @click="open = !open" type="button" class="bg-red">Cancel</button>
                <button @click="setRecord($event)" type="button">Ok</button>
            </div>
        </form>
    </div>
</body>

</html>